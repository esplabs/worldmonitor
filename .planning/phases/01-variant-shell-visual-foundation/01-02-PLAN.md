---
phase: 01-variant-shell-visual-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - src/styles/happy-theme.css
  - src/styles/main.css
  - index.html
autonomous: true
requirements:
  - THEME-01
  - THEME-03
  - THEME-04

must_haves:
  truths:
    - "When data-variant='happy' is set, all UI elements render with sage green, gold, and cream colors instead of dark military palette"
    - "Dark mode on the happy variant uses warm dark tones (deep navy, dark sage) — no pure black"
    - "Typography on the happy variant uses Nunito rounded sans-serif, not monospace"
    - "Semantic colors (critical, high, normal, status-live, etc.) are remapped to celebration gold, growth green, hope blue, kindness pink"
    - "The skeleton shell in index.html renders with warm colors when data-variant='happy' is present"
    - "There is no CSS specificity conflict between variant and theme selectors"
  artifacts:
    - path: "src/styles/happy-theme.css"
      provides: "Complete happy variant CSS custom property overrides for light mode, dark mode, and semantic colors"
      min_lines: 80
    - path: "src/styles/main.css"
      provides: "Import of happy-theme.css"
      contains: "@import './happy-theme.css'"
    - path: "index.html"
      provides: "Skeleton shell overrides for happy variant"
      contains: "data-variant=\"happy\""
  key_links:
    - from: "index.html"
      to: "src/styles/happy-theme.css"
      via: "data-variant attribute set by inline script, CSS selectors match"
      pattern: "\\[data-variant=\"happy\"\\]"
    - from: "src/styles/happy-theme.css"
      to: "src/styles/main.css"
      via: "@import directive"
      pattern: "@import.*happy-theme"
---

<objective>
Create the complete warm CSS theme for the happy variant — both light and dark modes — with Nunito typography and positive-semantic color system.

Purpose: Transform the visual identity from dark/military to calm/serene for any page element that uses CSS custom properties. Since the entire UI is built on CSS vars, redefining them under `[data-variant="happy"]` cascades the warm aesthetic to all existing components without touching component code.

Output: A new `happy-theme.css` with complete variable overrides, updated `main.css` import, and skeleton shell overrides in `index.html`.
</objective>

<execution_context>
@/Users/sebastienmelki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastienmelki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-variant-shell-visual-foundation/01-CONTEXT.md
@.planning/phases/01-variant-shell-visual-foundation/01-RESEARCH.md
@.planning/phases/01-variant-shell-visual-foundation/01-01-SUMMARY.md
@src/styles/main.css
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create happy-theme.css with complete warm palette and semantic overrides</name>
  <files>
    src/styles/happy-theme.css
    src/styles/main.css
  </files>
  <action>
    **1. Create `src/styles/happy-theme.css`** — This file defines ALL CSS custom property overrides for the happy variant. It must cover every variable defined in `:root` and `[data-theme="light"]` in main.css.

    **Color direction (per locked decisions):**
    - Vibe: Calm & serene — soothing, quiet optimism
    - Base background: Off-white/cream (#FAFAF5-ish)
    - Accents: Sage green + gold (muted sage for primary, warm gold for highlights)
    - Dark mode: Warm dark tones (deep navy, dark sage), never pure black

    **Structure the file as:**

    ```css
    /* ============================================================
       Happy Variant Theme — Calm & Serene
       Sage green + warm gold on cream. No dark military aesthetic.
       ============================================================ */

    /* ---------- Happy Light Mode (default) ---------- */
    [data-variant="happy"],
    [data-variant="happy"][data-theme="light"] {
      /* Backgrounds */
      --bg: #FAFAF5;
      --bg-secondary: #F5F3EE;
      --surface: #FFFFFF;
      --surface-hover: #F5F2EC;
      --surface-active: #EDE9E0;

      /* Borders */
      --border: #DDD9CF;
      --border-strong: #C8C2B5;
      --border-subtle: #EBE8E0;

      /* Text */
      --text: #2D3A2E;
      --text-secondary: #4A5A4C;
      --text-dim: #6B7A6D;
      --text-muted: #8A9A8C;
      --text-faint: #A8B4AA;
      --text-ghost: #C0C8C2;
      --accent: #3D4A3E;

      /* Overlays & shadows */
      --overlay-subtle: rgba(107, 143, 94, 0.03);
      --overlay-light: rgba(107, 143, 94, 0.05);
      --overlay-medium: rgba(107, 143, 94, 0.08);
      --overlay-heavy: rgba(107, 143, 94, 0.12);
      --shadow-color: rgba(80, 70, 50, 0.08);
      --darken-light: rgba(80, 70, 50, 0.06);
      --darken-medium: rgba(80, 70, 50, 0.10);
      --darken-heavy: rgba(80, 70, 50, 0.15);

      /* Scrollbar */
      --scrollbar-thumb: #C8C2B5;
      --scrollbar-thumb-hover: #A8A298;

      /* Input */
      --input-bg: #F2EFE8;

      /* Panels */
      --panel-bg: #FFFFFF;
      --panel-border: #DDD9CF;

      /* Map */
      --map-bg: #D4E6EC;
      --map-grid: #C0D8D8;
      --map-country: #B9CDA8;
      --map-stroke: #C8C0B5;

      /* Typography — Nunito rounded sans-serif */
      --font-body: 'Nunito', system-ui, -apple-system, sans-serif;

      /* Panel border radius — soft rounded corners (12-16px) */
      --panel-radius: 14px;
    }

    /* ---------- Happy Dark Mode ---------- */
    [data-variant="happy"][data-theme="dark"] {
      /* Backgrounds — deep navy, warm darks */
      --bg: #1A2332;
      --bg-secondary: #1E2838;
      --surface: #222E3E;
      --surface-hover: #2A3848;
      --surface-active: #2E3E50;

      /* Borders */
      --border: #344050;
      --border-strong: #445868;
      --border-subtle: #283545;

      /* Text — warm off-whites */
      --text: #E8E4DC;
      --text-secondary: #D0CCC4;
      --text-dim: #A0A098;
      --text-muted: #808880;
      --text-faint: #606860;
      --text-ghost: #485048;
      --accent: #E8E4DC;

      /* Overlays & shadows */
      --overlay-subtle: rgba(139, 175, 122, 0.03);
      --overlay-light: rgba(139, 175, 122, 0.06);
      --overlay-medium: rgba(139, 175, 122, 0.10);
      --overlay-heavy: rgba(139, 175, 122, 0.18);
      --shadow-color: rgba(0, 0, 0, 0.30);
      --darken-light: rgba(0, 0, 0, 0.15);
      --darken-medium: rgba(0, 0, 0, 0.20);
      --darken-heavy: rgba(0, 0, 0, 0.30);

      /* Scrollbar */
      --scrollbar-thumb: #445868;
      --scrollbar-thumb-hover: #5A6E80;

      /* Input */
      --input-bg: #283545;

      /* Panels */
      --panel-bg: #222E3E;
      --panel-border: #344050;

      /* Map */
      --map-bg: #16202E;
      --map-grid: #1E3040;
      --map-country: #2D4035;
      --map-stroke: #3D5045;

      /* Typography inherits from light variant selector */
      --font-body: 'Nunito', system-ui, -apple-system, sans-serif;
    }

    /* ---------- Happy Semantic Colors (both modes) ---------- */
    [data-variant="happy"] {
      /* Severity levels — remapped to positive semantics */
      --semantic-critical: #C4A35A;    /* celebration gold */
      --semantic-high: #6B8F5E;        /* growth green (sage) */
      --semantic-elevated: #7BA5C4;    /* hope blue */
      --semantic-normal: #6B8F5E;      /* growth green */
      --semantic-low: #C48B9F;         /* kindness pink */
      --semantic-info: #7BA5C4;        /* hope blue */

      /* Threat levels — remapped to positive tones */
      --threat-critical: #C4A35A;      /* gold */
      --threat-high: #8BAF7A;          /* lighter sage */
      --threat-medium: #7BA5C4;        /* blue */
      --threat-low: #6B8F5E;           /* sage green */
      --threat-info: #7BA5C4;          /* blue */

      /* DEFCON levels — warm gradient instead of warning */
      --defcon-1: #C4A35A;
      --defcon-2: #A8B86B;
      --defcon-3: #7BA5C4;
      --defcon-4: #6B8F5E;
      --defcon-5: #8BAF7A;

      /* Status indicators */
      --status-live: #6B8F5E;          /* sage green pulse */
      --status-cached: #C4A35A;        /* warm gold */
      --status-unavailable: #C48B9F;   /* soft pink, not alarming red */

      /* Legacy color aliases */
      --red: #C48B9F;                  /* kindness pink replaces red */
      --green: #6B8F5E;               /* sage green */
      --yellow: #C4A35A;              /* warm gold */
    }

    /* ---------- Happy Dark Mode Semantic Adjustments ---------- */
    [data-variant="happy"][data-theme="dark"] {
      /* Lighter variants for dark backgrounds */
      --semantic-critical: #D4B36A;
      --semantic-high: #8BAF7A;
      --semantic-elevated: #8BB5D4;
      --semantic-normal: #8BAF7A;
      --semantic-low: #D49BAF;
      --semantic-info: #8BB5D4;

      --threat-critical: #D4B36A;
      --threat-high: #9BBF8A;
      --threat-medium: #8BB5D4;
      --threat-low: #8BAF7A;
      --threat-info: #8BB5D4;

      --status-live: #8BAF7A;
      --status-cached: #D4B36A;
      --status-unavailable: #D49BAF;

      --red: #D49BAF;
      --green: #8BAF7A;
      --yellow: #D4B36A;
    }
    ```

    **Important CSS specificity notes:**
    - Use compound selectors `[data-variant="happy"][data-theme="dark"]` for dark mode to win over base `[data-theme="dark"]` (which doesn't exist in current CSS, but the `:root` serves as dark default).
    - The light mode selector `[data-variant="happy"]` (without data-theme) covers the default case.
    - Also include `[data-variant="happy"][data-theme="light"]` to ensure specificity wins over any `[data-theme="light"]` rules.
    - Place semantic colors in a `[data-variant="happy"]` block (no theme qualifier) so they apply to both modes, then override for dark mode.

    **2. Update `src/styles/main.css`** — Add the import at the top of the file, after the existing imports:
    ```css
    @import './happy-theme.css';
    ```
    Place it after `@import './panels.css';` (line 3).

    **Claude's discretion choices:**
    - Exact hex values above represent the calm/serene direction. Adjust if needed during implementation for contrast/readability.
    - Loading skeleton transitions: use same shimmer animation but with warmer tones (sage-tinted gradient).
    - Panel border-radius `--panel-radius: 14px` — introduced as a CSS variable so panels can reference it. If existing panel CSS doesn't use a var for border-radius, that wiring happens in Plan 03 (THEME-05).
  </action>
  <verify>
    Run `wc -l src/styles/happy-theme.css` to confirm substantial CSS (should be 80+ lines).
    Run `grep '@import.*happy-theme' src/styles/main.css` to confirm import is present.
    Run `grep -c 'data-variant.*happy' src/styles/happy-theme.css` to confirm variant selectors exist.
    Visually verify: start `npm run dev:happy`, open browser, add `data-variant="happy"` to html element in DevTools — confirm colors change.
  </verify>
  <done>
    - happy-theme.css contains complete CSS variable overrides for light mode, dark mode, and semantic colors
    - main.css imports happy-theme.css
    - All backgrounds, text, borders, overlays, map colors, scrollbar, input, and panel colors are overridden
    - Font is set to Nunito for the happy variant
    - Semantic colors are remapped from threat/severity to celebration/growth/hope/kindness
    - Dark mode uses warm navy/sage tones, never pure black
    - No specificity conflicts between variant and theme selectors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update index.html skeleton shell with happy variant overrides</name>
  <files>
    index.html
  </files>
  <action>
    **Add happy variant skeleton overrides** — In the inline `<style>` block in index.html (after the light theme skeleton overrides around line 131), add happy variant skeleton styles:

    ```css
    /* ---------- skeleton shell (happy variant — light) ---------- */
    [data-variant="happy"] .skeleton-shell{background:#FAFAF5;font-family:'Nunito',system-ui,sans-serif}
    [data-variant="happy"] .skeleton-header{background:#FFFFFF;border-bottom-color:#DDD9CF}
    [data-variant="happy"] .skeleton-pill{background:#F2EFE8;border-radius:8px}
    [data-variant="happy"] .skeleton-dot{background:#6B8F5E}
    [data-variant="happy"] .skeleton-main{background:#FAFAF5}
    [data-variant="happy"] .skeleton-map{border-color:#DDD9CF;background:#D4E6EC;border-radius:14px}
    [data-variant="happy"] .skeleton-map-bar{background:#FFFFFF;border-bottom-color:#DDD9CF}
    [data-variant="happy"] .skeleton-map-body::after{background:radial-gradient(ellipse 60% 50% at 50% 50%,#B9CDA8 0%,#D4E6EC 100%);opacity:.3}
    [data-variant="happy"] .skeleton-panel{background:#FFFFFF;border-color:#DDD9CF;border-radius:14px}
    [data-variant="happy"] .skeleton-panel-header{border-bottom-color:#EBE8E0}
    [data-variant="happy"] .skeleton-line{background:linear-gradient(90deg,rgba(107,143,94,.06) 25%,rgba(107,143,94,.12) 50%,rgba(107,143,94,.06) 75%);background-size:200% 100%;animation:skel-shimmer 1.5s infinite}

    /* ---------- skeleton shell (happy variant — dark) ---------- */
    [data-variant="happy"][data-theme="dark"] .skeleton-shell{background:#1A2332}
    [data-variant="happy"][data-theme="dark"] .skeleton-header{background:#222E3E;border-bottom-color:#344050}
    [data-variant="happy"][data-theme="dark"] .skeleton-pill{background:#2A3848}
    [data-variant="happy"][data-theme="dark"] .skeleton-dot{background:#8BAF7A}
    [data-variant="happy"][data-theme="dark"] .skeleton-main{background:#1A2332}
    [data-variant="happy"][data-theme="dark"] .skeleton-map{border-color:#344050;background:#16202E}
    [data-variant="happy"][data-theme="dark"] .skeleton-map-bar{background:#222E3E;border-bottom-color:#344050}
    [data-variant="happy"][data-theme="dark"] .skeleton-map-body::after{background:radial-gradient(ellipse 60% 50% at 50% 50%,#2D4035 0%,#16202E 100%);opacity:.3}
    [data-variant="happy"][data-theme="dark"] .skeleton-panel{background:#222E3E;border-color:#344050}
    [data-variant="happy"][data-theme="dark"] .skeleton-panel-header{border-bottom-color:#283545}
    [data-variant="happy"][data-theme="dark"] .skeleton-line{background:linear-gradient(90deg,rgba(139,175,122,.05) 25%,rgba(139,175,122,.10) 50%,rgba(139,175,122,.05) 75%);background-size:200% 100%;animation:skel-shimmer 1.5s infinite}
    ```

    **Also update the meta theme-color** — In `vite.config.ts` `htmlVariantPlugin`, add a replacement for the theme-color meta tag:
    ```typescript
    // After existing replacements, add:
    if (activeVariant === 'happy') {
      html = html.replace(
        /<meta name="theme-color" content=".*?" \/>/,
        '<meta name="theme-color" content="#FAFAF5" />'
      );
    }
    ```
    This ensures the browser chrome color matches the warm cream background on mobile.

    **Key implementation notes:**
    - The skeleton styles use the same happy color values defined in happy-theme.css for consistency.
    - The skeleton renders BEFORE main.css loads, so these must be inline in index.html.
    - The `data-variant` attribute is set by the inline script (added in Plan 01 Task 2) before the skeleton styles are evaluated.
    - Rounded corners (14px radius) applied to skeleton panels and map to match the soft rounded corners locked decision.
    - Skeleton pills also get rounded corners (8px) to feel softer.
  </action>
  <verify>
    Run `grep -c 'data-variant.*happy' index.html` to confirm happy skeleton styles were added (should be 20+ occurrences).
    Run `grep 'theme-color.*FAFAF5\|happy.*theme-color' vite.config.ts` to confirm theme-color replacement.
    Start `npm run dev:happy` and inspect the initial page load — skeleton should show warm colors before JS hydrates.
  </verify>
  <done>
    - index.html inline styles include happy variant skeleton overrides (both light and dark modes)
    - Skeleton uses Nunito font-family, cream background, sage dot, warm shimmer gradients
    - Skeleton panels and map have rounded corners (14px)
    - meta theme-color is updated to cream for the happy variant via htmlVariantPlugin
    - No flash of dark skeleton when loading happy variant
  </done>
</task>

</tasks>

<verification>
1. Start `npm run dev:happy` — page loads with warm cream background and Nunito font
2. Toggle dark mode — background shifts to deep navy (#1A2332), not pure black
3. Inspect computed CSS vars — `--bg` is `#FAFAF5` (light) or `#1A2332` (dark)
4. Semantic colors: `--semantic-critical` shows gold, `--status-live` shows sage green
5. Skeleton shell renders warm colors during the brief pre-JS loading phase
6. No CSS specificity issues — happy theme overrides base theme cleanly
</verification>

<success_criteria>
- Happy variant has a complete warm CSS theme (50+ CSS custom properties overridden)
- Both light and dark modes work with warm tones
- Typography is Nunito sans-serif, not monospace
- Semantic colors are remapped to positive tones (gold, sage, blue, pink)
- Skeleton shell matches the warm theme during initial load
- No visual flash of dark theme when loading happy variant
</success_criteria>

<output>
After completion, create `.planning/phases/01-variant-shell-visual-foundation/01-02-SUMMARY.md`
</output>
